<div class="card shadow-sm mb-4">
  <div class="card-body p-md-5">
    <h2 class="text-center mb-4">学习风格诊断报告</h2>
    
    <!-- 报告头部信息 -->
    <div class="row mb-5">
      <div class="col-md-6">
        <h5>基本信息</h5>
        <ul class="list-unstyled">
          <li><strong>姓名：</strong><%= report.user.name %></li>
          <li><strong>年龄：</strong><%= report.user.age %> 岁</li>
          <li><strong>年级：</strong><%= report.user.grade %></li>
          <li><strong>测评日期：</strong><%= new Date(report.createdAt).toLocaleDateString('zh-CN') %></li>
        </ul>
      </div>
      <div class="col-md-6">
        <h5>学习风格类型</h5>
        <div class="d-flex align-items-center">
          <span class="badge bg-primary p-2 fs-5"><%= report.learningTypeCode %></span>
          <span class="ms-3"><%= report.isMixedType ? '混合型' : '主导型' %></span>
        </div>
        <p class="mt-2"><%= report.learningTypeDescription %></p>
      </div>
    </div>

    <!-- 操作按钮 -->
    <div class="text-end mb-5">
      <a href="/survey/start" class="btn btn-primary">
        <i class="fas fa-sync-alt me-2"></i>重新测评
      </a>
    </div>
    
    <!-- 总体分析图表 -->
    <div class="report-section">
      <h3 class="report-heading">学习风格分析</h3>
      <div class="row g-4">
        <!-- 感知偏好雷达图 -->
        <div class="col-lg-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0">感知偏好</h4>
            </div>
            <div class="card-body d-flex flex-column">
              <!-- 主导类型信息 -->
              <div class="mb-3 p-3 bg-light rounded">
                <div class="d-flex align-items-center justify-content-between">
                  <div><strong>主导类型：</strong></div>
                  <span class="badge bg-success p-2 px-3"><%= report.dominantType.perceptionType %></span>
                </div>
                <div class="mt-2">
                  <small>
                    <% if (report.dominantType.perceptionType === '视觉型') { %>
                      您主要通过视觉获取信息，偏好图表、图像等可视化学习资料。
                    <% } else if (report.dominantType.perceptionType === '听觉型') { %>
                      您主要通过听觉获取信息，偏好讲解、讨论等听觉学习方式。
                    <% } else if (report.dominantType.perceptionType === '动觉型') { %>
                      您主要通过动手实践获取信息，偏好实验、操作等体验式学习。
                    <% } %>
                  </small>
                </div>
              </div>
              
              <!-- 图表区域 -->
              <div class="chart-container bg-light rounded p-2" style="position: relative; height: 400px; margin-bottom: 30px;">
                <canvas id="perceptionChart" 
                  data-visual="<%= report.scores.perception.visual %>" 
                  data-auditory="<%= report.scores.perception.auditory %>" 
                  data-kinesthetic="<%= report.scores.perception.kinesthetic %>">
                </canvas>
              </div>
              
              <!-- 分隔线 -->
              <hr class="my-4 w-100" style="border-top: 2px solid #e9ecef; margin-left: auto; margin-right: auto;">
              
              <!-- 分数明细 -->
              <div class="mt-5" style="padding-top: 10px;">
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <span>视觉学习型:</span>
                  <div class="progress flex-grow-1 mx-2" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" style="width: <%= report.scores.perception.visual %>%;" 
                      aria-valuenow="<%= report.scores.perception.visual %>" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                  <span class="badge bg-secondary"><%= report.scores.perception.visual %>%</span>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-1">
                  <span>听觉学习型:</span>
                  <div class="progress flex-grow-1 mx-2" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" style="width: <%= report.scores.perception.auditory %>%;" 
                      aria-valuenow="<%= report.scores.perception.auditory %>" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                  <span class="badge bg-secondary"><%= report.scores.perception.auditory %>%</span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                  <span>动觉学习型:</span>
                  <div class="progress flex-grow-1 mx-2" style="height: 8px;">
                    <div class="progress-bar" role="progressbar" style="width: <%= report.scores.perception.kinesthetic %>%;" 
                      aria-valuenow="<%= report.scores.perception.kinesthetic %>" aria-valuemin="0" aria-valuemax="100"></div>
                  </div>
                  <span class="badge bg-secondary"><%= report.scores.perception.kinesthetic %>%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 其他维度条形图 -->
        <div class="col-lg-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0">其他维度分析</h4>
            </div>
            <div class="card-body d-flex flex-column">
              <!-- 各维度主导类型信息 -->
              <div class="mb-3 p-3 bg-light rounded">
                <div class="row">
                  <div class="col-md-6">
                    <div class="d-flex align-items-center mb-2">
                      <div class="me-2"><strong>信息处理:</strong></div>
                      <span class="badge bg-primary"><%= report.dominantType.processingType %></span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                      <div class="me-2"><strong>学习环境:</strong></div>
                      <span class="badge bg-primary"><%= report.dominantType.environmentType %></span>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="d-flex align-items-center mb-2">
                      <div class="me-2"><strong>思维模式:</strong></div>
                      <span class="badge bg-primary"><%= report.dominantType.thinkingType %></span>
                    </div>
                    <div class="d-flex align-items-center mb-2">
                      <div class="me-2"><strong>时间管理:</strong></div>
                      <span class="badge bg-primary"><%= report.dominantType.timeManagementType %></span>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- 图表区域 -->
              <div class="chart-container bg-light rounded p-2" style="position: relative; height: 400px; margin-bottom: 30px;">
                <canvas id="dimensionsChart"
                  data-systematic="<%= report.scores.processing.systematic %>"
                  data-global="<%= report.scores.processing.global %>"
                  data-structured="<%= report.scores.environment.structured %>"
                  data-flexible="<%= report.scores.environment.flexible %>"
                  data-analytical="<%= report.scores.thinking.analytical %>"
                  data-creative="<%= report.scores.thinking.creative %>"
                  data-planned="<%= report.scores.timeManagement.planned %>"
                  data-adaptive="<%= report.scores.timeManagement.adaptive %>">
                </canvas>
              </div>
              
              <!-- 分隔线 -->
              <hr class="my-4 w-100" style="border-top: 2px solid #e9ecef; margin-left: auto; margin-right: auto;">
              
              <!-- 维度特征说明 -->
              <div class="mt-5" style="padding-top: 10px;">
                <p class="mb-0 small">
                  <% if (report.dominantType.processingType === '系统性') { %>
                    您倾向于按顺序处理信息，注重细节和系统化学习方法。结合
                  <% } else { %>
                    您倾向于从整体把握信息，善于建立概念间联系。结合
                  <% } %>
                  <% if (report.dominantType.thinkingType === '分析型') { %>
                    分析型思维，您善于逻辑推理和批判性思考。
                  <% } else { %>
                    创造型思维，您善于发散思维和创意生成。
                  <% } %>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 维度详细分析 -->
    <div class="report-section">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="report-heading mb-0">维度详细分析</h3>
        <div class="d-flex align-items-center">
          <button id="generateAllAdviceBtn" class="btn btn-primary btn-sm">
            <i class="fas fa-magic me-1"></i> 生成AI建议
          </button>
          <div id="adviceLoading" class="d-none ms-2">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">正在生成建议...</span>
            </div>
          </div>
        </div>
      </div>
      
      <div id="adviceError" class="alert alert-danger d-none mb-4">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorMessage">生成建议时出错</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      <div class="row g-4">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0">信息处理方式</h4>
            </div>
            <div class="card-body">
              <div class="progress mb-3" style="height: 24px;">
                <div class="progress-bar" role="progressbar" style="width: <%= report.scores.processing.systematic %>%;" 
                  aria-valuenow="<%= report.scores.processing.systematic %>" aria-valuemin="0" aria-valuemax="100">
                  系统性 <%= report.scores.processing.systematic %>%
                </div>
                <div class="progress-bar bg-success" role="progressbar" style="width: <%= report.scores.processing.global %>%;" 
                  aria-valuenow="<%= report.scores.processing.global %>" aria-valuemin="0" aria-valuemax="100">
                  跳跃性 <%= report.scores.processing.global %>%
                </div>
              </div>
              <p>主导类型：<strong><%= report.dominantType.processingType %></strong></p>
              <p><%= report.dominantType.processingType === '系统性' ? 
                '您倾向于按照逻辑顺序处理信息，注重细节和系统化学习。' : 
                '您倾向于从整体把握信息，善于在不同概念间建立联系。' %></p>
              
              <!-- 家长建议内容 -->
              <div class="parent-advice-content processing-advice mt-3">
                <div class="p-3 bg-light rounded">
                  <h6 class="mb-2"><i class="fas fa-user-graduate text-primary me-2"></i>培养建议</h6>
                  <p class="advice-cultivation small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-book text-primary me-2"></i>学习建议</h6>
                  <p class="advice-learning small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-home text-primary me-2"></i>家庭活动建议</h6>
                  <p class="advice-activities small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-heart text-primary me-2"></i>家庭关系建议</h6>
                  <p class="advice-relationship small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-comments text-primary me-2"></i>沟通建议</h6>
                  <p class="advice-communication small"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0">学习环境偏好</h4>
            </div>
            <div class="card-body">
              <div class="progress mb-3" style="height: 24px;">
                <div class="progress-bar" role="progressbar" style="width: <%= report.scores.environment.structured %>%;" 
                  aria-valuenow="<%= report.scores.environment.structured %>" aria-valuemin="0" aria-valuemax="100">
                  结构化 <%= report.scores.environment.structured %>%
                </div>
                <div class="progress-bar bg-success" role="progressbar" style="width: <%= report.scores.environment.flexible %>%;" 
                  aria-valuenow="<%= report.scores.environment.flexible %>" aria-valuemin="0" aria-valuemax="100">
                  灵活型 <%= report.scores.environment.flexible %>%
                </div>
              </div>
              <p>主导类型：<strong><%= report.dominantType.environmentType %></strong></p>
              <p><%= report.dominantType.environmentType === '结构化' ? 
                '您在安静、有序的学习环境中表现最佳，需要明确的规则和期望。' : 
                '您适应多种学习环境，可以在不同条件下有效学习。' %></p>
              
              <!-- 家长建议内容 -->
              <div class="parent-advice-content environment-advice mt-3">
                <div class="p-3 bg-light rounded">
                  <h6 class="mb-2"><i class="fas fa-user-graduate text-primary me-2"></i>培养建议</h6>
                  <p class="advice-cultivation small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-book text-primary me-2"></i>学习建议</h6>
                  <p class="advice-learning small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-home text-primary me-2"></i>家庭活动建议</h6>
                  <p class="advice-activities small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-heart text-primary me-2"></i>家庭关系建议</h6>
                  <p class="advice-relationship small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-comments text-primary me-2"></i>沟通建议</h6>
                  <p class="advice-communication small"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0">思维模式</h4>
            </div>
            <div class="card-body">
              <div class="progress mb-3" style="height: 24px;">
                <div class="progress-bar" role="progressbar" style="width: <%= report.scores.thinking.analytical %>%;" 
                  aria-valuenow="<%= report.scores.thinking.analytical %>" aria-valuemin="0" aria-valuemax="100">
                  分析型 <%= report.scores.thinking.analytical %>%
                </div>
                <div class="progress-bar bg-success" role="progressbar" style="width: <%= report.scores.thinking.creative %>%;" 
                  aria-valuenow="<%= report.scores.thinking.creative %>" aria-valuemin="0" aria-valuemax="100">
                  创造型 <%= report.scores.thinking.creative %>%
                </div>
              </div>
              <p>主导类型：<strong><%= report.dominantType.thinkingType %></strong></p>
              <p><%= report.dominantType.thinkingType === '分析型' ? 
                '您善于逻辑分析和批判性思考，注重效率和准确性。' : 
                '您善于发散思维和创意生成，喜欢开放性问题和多种可能性。' %></p>
              
              <!-- 家长建议内容 -->
              <div class="parent-advice-content thinking-advice mt-3">
                <div class="p-3 bg-light rounded">
                  <h6 class="mb-2"><i class="fas fa-user-graduate text-primary me-2"></i>培养建议</h6>
                  <p class="advice-cultivation small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-book text-primary me-2"></i>学习建议</h6>
                  <p class="advice-learning small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-home text-primary me-2"></i>家庭活动建议</h6>
                  <p class="advice-activities small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-heart text-primary me-2"></i>家庭关系建议</h6>
                  <p class="advice-relationship small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-comments text-primary me-2"></i>沟通建议</h6>
                  <p class="advice-communication small"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0">时间管理倾向</h4>
            </div>
            <div class="card-body">
              <div class="progress mb-3" style="height: 24px;">
                <div class="progress-bar" role="progressbar" style="width: <%= report.scores.timeManagement.planned %>%;" 
                  aria-valuenow="<%= report.scores.timeManagement.planned %>" aria-valuemin="0" aria-valuemax="100">
                  计划型 <%= report.scores.timeManagement.planned %>%
                </div>
                <div class="progress-bar bg-success" role="progressbar" style="width: <%= report.scores.timeManagement.adaptive %>%;" 
                  aria-valuenow="<%= report.scores.timeManagement.adaptive %>" aria-valuemin="0" aria-valuemax="100">
                  适应型 <%= report.scores.timeManagement.adaptive %>%
                </div>
              </div>
              <p>主导类型：<strong><%= report.dominantType.timeManagementType %></strong></p>
              <p><%= report.dominantType.timeManagementType === '计划型' ? 
                '您喜欢制定详细计划并按计划执行，有条理且善于管理截止日期。' : 
                '您灵活应对不同任务和时间需求，善于即兴应变和调整。' %></p>
              
              <!-- 家长建议内容 -->
              <div class="parent-advice-content timeManagement-advice mt-3">
                <div class="p-3 bg-light rounded">
                  <h6 class="mb-2"><i class="fas fa-user-graduate text-primary me-2"></i>培养建议</h6>
                  <p class="advice-cultivation small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-book text-primary me-2"></i>学习建议</h6>
                  <p class="advice-learning small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-home text-primary me-2"></i>家庭活动建议</h6>
                  <p class="advice-activities small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-heart text-primary me-2"></i>家庭关系建议</h6>
                  <p class="advice-relationship small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-comments text-primary me-2"></i>沟通建议</h6>
                  <p class="advice-communication small"></p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 感知偏好也添加AI家长建议按钮和内容框 -->
        <div class="col-md-12 mt-3">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0">感知偏好家长建议</h4>
            </div>
            <div class="card-body">
              <p>您的孩子主导感知类型：<strong><%= report.dominantType.perceptionType %></strong></p>
              <p><%= report.dominantType.perceptionType === '视觉型' ? 
                '孩子主要通过视觉获取信息，偏好图表、图像等可视化学习资料。' : 
                report.dominantType.perceptionType === '听觉型' ? 
                '孩子主要通过听觉获取信息，偏好讲解、讨论等听觉学习方式。' : 
                '孩子主要通过动手实践获取信息，偏好实验、操作等体验式学习。' %></p>
              
              <!-- 家长建议内容 -->
              <div class="parent-advice-content perception-advice mt-3">
                <div class="p-3 bg-light rounded">
                  <h6 class="mb-2"><i class="fas fa-user-graduate text-primary me-2"></i>培养建议</h6>
                  <p class="advice-cultivation small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-book text-primary me-2"></i>学习建议</h6>
                  <p class="advice-learning small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-home text-primary me-2"></i>家庭活动建议</h6>
                  <p class="advice-activities small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-heart text-primary me-2"></i>家庭关系建议</h6>
                  <p class="advice-relationship small"></p>
                  
                  <h6 class="mb-2"><i class="fas fa-comments text-primary me-2"></i>沟通建议</h6>
                  <p class="advice-communication small"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 优势与挑战 -->
    <div class="report-section">
      <h3 class="report-heading">优势与挑战</h3>
      <div class="row">
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0"><i class="fas fa-star text-warning me-2"></i>学习优势</h4>
            </div>
            <div class="card-body">
              <ul class="list-unstyled">
                <% report.strengths.forEach(strength => { %>
                  <li class="strength-item mb-2"><%= strength %></li>
                <% }); %>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-header bg-light">
              <h4 class="card-title h5 mb-0"><i class="fas fa-exclamation-triangle text-warning me-2"></i>学习挑战</h4>
            </div>
            <div class="card-body">
              <ul class="list-unstyled">
                <% report.challenges.forEach(challenge => { %>
                  <li class="challenge-item mb-2"><%= challenge %></li>
                <% }); %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 学习策略推荐 -->
    <div class="report-section">
      <h3 class="report-heading">个性化学习策略</h3>
      
      <!-- 通用学习策略 -->
      <div class="card mb-4">
        <div class="card-header bg-light">
          <h4 class="card-title h5 mb-0">通用学习策略</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-6">
              <ul class="list-unstyled">
                <% report.strategies.slice(0, Math.ceil(report.strategies.length / 2)).forEach(strategy => { %>
                  <li class="strategy-item mb-2"><%= strategy %></li>
                <% }); %>
              </ul>
            </div>
            <div class="col-lg-6">
              <ul class="list-unstyled">
                <% report.strategies.slice(Math.ceil(report.strategies.length / 2)).forEach(strategy => { %>
                  <li class="strategy-item mb-2"><%= strategy %></li>
                <% }); %>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 学科特定策略 -->
      <div class="card">
        <div class="card-header bg-light">
          <h4 class="card-title h5 mb-0">学科特定策略</h4>
        </div>
        <div class="card-body">
          <div class="row g-4">
            <div class="col-md-6">
              <h5><i class="fas fa-calculator text-primary me-2"></i>数学学习</h5>
              <ul class="list-unstyled">
                <% if (report.dominantType.perceptionType === '视觉型') { %>
                  <li class="strategy-item mb-2">使用图形、图表来理解数学概念</li>
                  <li class="strategy-item mb-2">绘制思维导图整理公式关系</li>
                  <li class="strategy-item mb-2">观看数学视频教程加深理解</li>
                  <li class="strategy-item mb-2">用不同颜色标注重点解题步骤</li>
                <% } else if (report.dominantType.perceptionType === '听觉型') { %>
                  <li class="strategy-item mb-2">朗读数学概念和公式加深记忆</li>
                  <li class="strategy-item mb-2">参与数学小组讨论交流解题思路</li>
                  <li class="strategy-item mb-2">录制解题过程进行自我讲解</li>
                  <li class="strategy-item mb-2">听数学讲解音频巩固知识点</li>
                <% } else { %>
                  <li class="strategy-item mb-2">动手操作数学教具理解概念</li>
                  <li class="strategy-item mb-2">通过实际测量和计算学习几何</li>
                  <li class="strategy-item mb-2">制作数学模型加深空间认知</li>
                  <li class="strategy-item mb-2">参与数学实验和实践活动</li>
                <% } %>
              </ul>
            </div>
            <div class="col-md-6">
              <h5><i class="fas fa-book text-primary me-2"></i>语文学习</h5>
              <ul class="list-unstyled">
                <% if (report.dominantType.perceptionType === '视觉型') { %>
                  <li class="strategy-item mb-2">制作生字卡片进行视觉记忆</li>
                  <li class="strategy-item mb-2">用思维导图梳理文章结构</li>
                  <li class="strategy-item mb-2">观看名著改编视频理解情节</li>
                  <li class="strategy-item mb-2">通过图文并茂的方式写作文</li>
                <% } else if (report.dominantType.perceptionType === '听觉型') { %>
                  <li class="strategy-item mb-2">朗读课文感受文章韵律</li>
                  <li class="strategy-item mb-2">听有声读物提高理解能力</li>
                  <li class="strategy-item mb-2">参与课文朗诵和讨论活动</li>
                  <li class="strategy-item mb-2">录制朗读音频进行自我纠正</li>
                <% } else { %>
                  <li class="strategy-item mb-2">通过角色扮演理解课文内容</li>
                  <li class="strategy-item mb-2">手写摘抄优美段落</li>
                  <li class="strategy-item mb-2">参与情景剧表演体验文学</li>
                  <li class="strategy-item mb-2">制作手抄报整理学习内容</li>
                <% } %>
              </ul>
            </div>
            <div class="col-md-6">
              <h5><i class="fas fa-globe text-primary me-2"></i>英语学习</h5>
              <ul class="list-unstyled">
                <% if (report.dominantType.perceptionType === '视觉型') { %>
                  <li class="strategy-item mb-2">使用图文词卡记忆单词</li>
                  <li class="strategy-item mb-2">观看英文字幕视频学习</li>
                  <li class="strategy-item mb-2">制作语法结构图表</li>
                  <li class="strategy-item mb-2">阅读图文并茂的英文绘本</li>
                <% } else if (report.dominantType.perceptionType === '听觉型') { %>
                  <li class="strategy-item mb-2">听英文歌曲和有声读物</li>
                  <li class="strategy-item mb-2">参与英语口语练习和对话</li>
                  <li class="strategy-item mb-2">跟读音频练习发音语调</li>
                  <li class="strategy-item mb-2">录制口语进行自我评估</li>
                <% } else { %>
                  <li class="strategy-item mb-2">通过肢体动作学习单词</li>
                  <li class="strategy-item mb-2">参与英语角色扮演活动</li>
                  <li class="strategy-item mb-2">进行英语手工制作活动</li>
                  <li class="strategy-item mb-2">玩英语互动游戏学习</li>
                <% } %>
              </ul>
            </div>
            <div class="col-md-6">
              <h5><i class="fas fa-flask text-primary me-2"></i>科学学习</h5>
              <ul class="list-unstyled">
                <% if (report.dominantType.perceptionType === '视觉型') { %>
                  <li class="strategy-item mb-2">观看科学实验视频</li>
                  <li class="strategy-item mb-2">绘制实验流程图和观察图</li>
                  <li class="strategy-item mb-2">使用科学图谱学习原理</li>
                  <li class="strategy-item mb-2">制作科学知识思维导图</li>
                <% } else if (report.dominantType.perceptionType === '听觉型') { %>
                  <li class="strategy-item mb-2">听科普讲座和音频资料</li>
                  <li class="strategy-item mb-2">参与科学现象讨论</li>
                  <li class="strategy-item mb-2">用口头方式描述实验过程</li>
                  <li class="strategy-item mb-2">进行科学知识口头汇报</li>
                <% } else { %>
                  <li class="strategy-item mb-2">动手做科学实验</li>
                  <li class="strategy-item mb-2">制作科学模型</li>
                  <li class="strategy-item mb-2">参与科技制作活动</li>
                  <li class="strategy-item mb-2">进行实地考察和观测</li>
                <% } %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 后续行动 -->
    <div class="report-section">
      <h3 class="report-heading">后续行动建议</h3>
      <div class="card">
        <div class="card-body">
          <div class="row g-4">
            <div class="col-md-4">
              <div class="card h-100 border-0 bg-light">
                <div class="card-body">
                  <h5 class="card-title"><i class="fas fa-bolt text-warning me-2"></i>立即行动</h5>
                  <p class="card-text">选择2-3个符合您学习风格的策略，在未来一周内尝试应用到日常学习中。</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card h-100 border-0 bg-light">
                <div class="card-body">
                  <h5 class="card-title"><i class="fas fa-calendar-alt text-info me-2"></i>近期计划</h5>
                  <p class="card-text">在未来一个月内，逐步应用更多学习策略，并记录效果，保留有效方法。</p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card h-100 border-0 bg-light">
                <div class="card-body">
                  <h5 class="card-title"><i class="fas fa-chart-line text-success me-2"></i>长期发展</h5>
                  <p class="card-text">每学期进行一次重新测评，追踪学习风格变化，持续优化学习方法。</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- 常见问题解答 -->
    <div class="report-section">
      <h3 class="report-heading">常见问题解答</h3>
      <div class="card">
        <div class="card-body">
          <div class="accordion" id="faqAccordion">
            <div class="accordion-item">
              <h4 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                  学习风格会随年龄变化吗？
                </button>
              </h4>
              <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  是的，学习风格有一定的可塑性，随着年龄和经验可能发生变化。建议每学年进行一次重新评估，追踪自然发展和有意识培养带来的变化。
                </div>
              </div>
            </div>
            
            <div class="accordion-item">
              <h4 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                  如果我的测评结果显示"混合型"怎么办？
                </button>
              </h4>
              <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  混合型学习者在某些维度没有明显偏好，这实际上是一种优势，意味着你适应性更强。报告会提供平衡使用不同策略的建议。
                </div>
              </div>
            </div>
            
            <div class="accordion-item">
              <h4 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                  如何向老师解释我的学习风格？
                </button>
              </h4>
              <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  你可以分享报告摘要，特别是学习策略部分。与老师讨论哪些教学方法最适合你，以及如何在课堂上做出适当调整。
                </div>
              </div>
            </div>
            
            <div class="accordion-item">
              <h4 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                  家长如何利用孩子的学习风格报告？
                </button>
              </h4>
              <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  家长可以帮助创造适合孩子学习风格的环境，选择匹配的学习资源，并鼓励使用报告中建议的学习策略。避免强制使用不适合的学习方法。
                </div>
              </div>
            </div>
            
            <div class="accordion-item">
              <h4 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                  学习风格和学科表现有直接关系吗？
                </button>
              </h4>
              <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                  学习风格与学科表现有关联但不决定性。适合的学习方法可以提高任何学科的学习效率，但内容兴趣和基础知识同样重要。
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 术语解释表 -->
    <div class="report-section">
      <h3 class="report-heading">术语解释表</h3>
      <div class="card">
        <div class="card-body">
          <div class="row g-4">
            <div class="col-md-6">
              <dl>
                <dt class="mb-2"><i class="fas fa-eye text-primary me-2"></i>感知偏好</dt>
                <dd class="text-muted mb-4">获取信息的主要感官渠道，包括视觉、听觉和动觉。</dd>
                
                <dt class="mb-2"><i class="fas fa-brain text-primary me-2"></i>信息处理方式</dt>
                <dd class="text-muted mb-4">组织和处理信息的习惯模式，可以是线性系统的或跳跃整体的。</dd>
                
                <dt class="mb-2"><i class="fas fa-home text-primary me-2"></i>学习环境偏好</dt>
                <dd class="text-muted mb-4">最有利于学习的外部条件和环境特征。</dd>
              </dl>
            </div>
            <div class="col-md-6">
              <dl>
                <dt class="mb-2"><i class="fas fa-lightbulb text-primary me-2"></i>思维模式</dt>
                <dd class="text-muted mb-4">解决问题和处理信息的思维倾向，包括分析型和创造型。</dd>
                
                <dt class="mb-2"><i class="fas fa-clock text-primary me-2"></i>时间管理倾向</dt>
                <dd class="text-muted mb-4">安排和管理学习任务和时间的习惯方式。</dd>
                
                <dt class="mb-2"><i class="fas fa-book text-primary me-2"></i>学习策略</dt>
                <dd class="text-muted mb-4">有意识采用的提高学习效率和效果的方法和技巧。</dd>
              </dl>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const reportId = '<%= report._id %>';
    let parentAdvice = null;
    
    // 显示加载状态
    function showLoadingState() {
      const loadingElement = document.getElementById('adviceLoading');
      const generateAllBtn = document.getElementById('generateAllAdviceBtn');
      
      loadingElement.classList.remove('d-none');
      generateAllBtn.disabled = true;
      generateAllBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>正在生成...';
    }

    // 隐藏加载状态
    function hideLoadingState() {
      const loadingElement = document.getElementById('adviceLoading');
      const generateAllBtn = document.getElementById('generateAllAdviceBtn');
      
      loadingElement.classList.add('d-none');
      generateAllBtn.disabled = false;
      generateAllBtn.innerHTML = '<i class="fas fa-magic me-1"></i> 生成AI建议';
    }

    // 显示错误信息
    function showError(message) {
      const errorElement = document.getElementById('adviceError');
      document.getElementById('errorMessage').textContent = message;
      errorElement.classList.remove('d-none');
    }

    // 更新建议内容
    function updateAdviceContent(dimension, advice) {
      const container = document.querySelector(`.${dimension}-advice`);
      if (!container) return;

      const fields = [
        { key: '培养建议', class: 'cultivation' },
        { key: '学习建议', class: 'learning' },
        { key: '家庭活动建议', class: 'activities' },
        { key: '家庭关系建议', class: 'relationship' },
        { key: '沟通建议', class: 'communication' }
      ];

      fields.forEach(field => {
        const element = container.querySelector(`.advice-${field.class}`);
        if (element) {
          element.textContent = advice[field.key] || '暂无建议';
        }
      });
    }

    // 生成并显示所有建议
    async function generateAllAdvice() {
      try {
        showLoadingState();
        document.getElementById('adviceError').classList.add('d-none');
        
        const response = await fetch(`/report/view/${reportId}/parent-advice`);
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        if (!data.success) {
          throw new Error(data.message || '获取建议失败');
        }
        
        parentAdvice = data.data;
        
        // 更新每个维度的建议内容
        const dimensions = {
          '感知偏好': 'perception',
          '信息处理方式': 'processing',
          '学习环境偏好': 'environment',
          '思维模式': 'thinking',
          '时间管理倾向': 'timeManagement'
        };

        for (const [dimensionName, dimensionKey] of Object.entries(dimensions)) {
          if (parentAdvice[dimensionName]) {
            updateAdviceContent(dimensionKey, parentAdvice[dimensionName]);
          }
        }
        
      } catch (error) {
        console.error('生成建议时出错:', error);
        showError(error.message || '生成建议时出错，请稍后重试');
      } finally {
        hideLoadingState();
      }
    }

    // 添加生成按钮事件监听
    document.getElementById('generateAllAdviceBtn').addEventListener('click', generateAllAdvice);
  });
</script> 
